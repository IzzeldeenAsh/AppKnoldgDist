"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[8167],{8167:(ot,C,l)=>{l.r(C),l.d(C,{SalesModule:()=>K});var _=l(177),O=l(2791),S=l(5098),R=l(1413),E=l(7468),b=l(6977),T=l(6697),c=l(2288),u=l(2578),t=l(4438),k=l(9920),w=l(7112),v=l(9820);const P=["revenueChart"],y=["knowledgeChart"],M=["meetingChart"],$=["revenueChartContainer"],I=["knowledgeChartContainer"],F=["meetingChartContainer"],D=r=>({active:r});function N(r,g){if(1&r&&(t.j41(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",26),t.EFF(4),t.k0s(),t.j41(5,"div",27),t.EFF(6),t.nI1(7,"number"),t.k0s()()()()),2&r){const e=t.XpG(2);t.R7$(4),t.JRh(e.getText("NET_PROFIT")),t.R7$(2),t.SpI("$",t.i5U(7,2,e.totalStatistics.order_statistics.insighter_orders_amount,"1.2-2"),"")}}function A(r,g){if(1&r&&(t.j41(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",26),t.EFF(4),t.k0s(),t.j41(5,"div",27),t.EFF(6),t.nI1(7,"number"),t.k0s()()()()),2&r){const e=t.XpG(2);t.R7$(4),t.JRh(e.getText("COMPANY_NET_PROFIT")),t.R7$(2),t.SpI("$",t.i5U(7,2,e.totalStatistics.order_statistics.company_orders_amount,"1.2-2"),"")}}function j(r,g){if(1&r&&(t.j41(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25)(4,"div",26),t.EFF(5),t.k0s(),t.j41(6,"div",27),t.EFF(7),t.nI1(8,"number"),t.k0s()()()(),t.j41(9,"div",23)(10,"div",24)(11,"div",25)(12,"div",26),t.EFF(13),t.k0s(),t.j41(14,"div",27),t.EFF(15),t.nI1(16,"number"),t.k0s()()()(),t.DNE(17,N,8,5,"div",28)(18,A,8,5,"div",28),t.k0s()),2&r){const e=t.XpG();t.R7$(5),t.JRh(e.getText("TOTAL_ORDERS")),t.R7$(2),t.JRh(t.bMT(8,6,e.totalStatistics.order_statistics.orders_total)),t.R7$(6),t.JRh(e.getText("ORDERS_REVENUE")),t.R7$(2),t.SpI("$",t.i5U(16,8,e.totalStatistics.order_statistics.orders_amount,"1.2-2"),""),t.R7$(2),t.Y8G("ngIf",!e.isCompany),t.R7$(),t.Y8G("ngIf",e.isCompany)}}function G(r,g){if(1&r){const e=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){const n=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.onPeriodChange(n.value))}),t.EFF(1),t.k0s()}if(2&r){const e=g.$implicit,o=t.XpG();t.Y8G("ngClass",t.eq3(3,D,o.selectedPeriod===e.value))("disabled",o.isLoading),t.R7$(),t.SpI(" ","ar"===o.lang?e.labelAr:e.label," ")}}function L(r,g){if(1&r&&(t.j41(0,"div",30,0),t.nrm(2,"p-chart",31,1),t.k0s()),2&r){const e=t.XpG();t.R7$(2),t.Y8G("data",e.revenueChartData)("options",e.revenueChartOptions)}}function W(r,g){if(1&r&&(t.j41(0,"div",32)(1,"div",33)(2,"span",34),t.EFF(3),t.k0s()()()),2&r){const e=t.XpG();t.R7$(3),t.JRh(e.getText("LOADING"))}}function z(r,g){if(1&r&&(t.j41(0,"div",30,2),t.nrm(2,"p-chart",46,3),t.k0s()),2&r){const e=t.XpG(2);t.R7$(2),t.Y8G("data",e.knowledgeChartData)("options",e.knowledgeChartOptions)}}function B(r,g){if(1&r&&(t.j41(0,"div",32)(1,"div",33)(2,"span",34),t.EFF(3),t.k0s()()()),2&r){const e=t.XpG(2);t.R7$(3),t.JRh(e.getText("LOADING"))}}function U(r,g){if(1&r&&(t.j41(0,"div",30,4),t.nrm(2,"p-chart",46,5),t.k0s()),2&r){const e=t.XpG(2);t.R7$(2),t.Y8G("data",e.meetingChartData)("options",e.meetingChartOptions)}}function Y(r,g){if(1&r&&(t.j41(0,"div",32)(1,"div",33)(2,"span",34),t.EFF(3),t.k0s()()()),2&r){const e=t.XpG(2);t.R7$(3),t.JRh(e.getText("LOADING"))}}function H(r,g){if(1&r){const e=t.RV6();t.j41(0,"div",35)(1,"div",36)(2,"div",37)(3,"div",38)(4,"div",39)(5,"h4",11)(6,"span",12),t.EFF(7),t.k0s()(),t.j41(8,"button",13),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.exportKnowledgeToExcel())}),t.nrm(9,"i",14),t.EFF(10),t.k0s()()(),t.j41(11,"div",40)(12,"div",41)(13,"div",42)(14,"div",43)(15,"div",44),t.EFF(16),t.k0s(),t.j41(17,"div",45),t.EFF(18),t.nI1(19,"number"),t.k0s()()(),t.j41(20,"div",42)(21,"div",43)(22,"div",44),t.EFF(23),t.k0s(),t.j41(24,"div",45),t.EFF(25),t.nI1(26,"number"),t.k0s()()()(),t.DNE(27,z,4,2,"div",19)(28,B,4,1,"div",20),t.k0s()()(),t.j41(29,"div",36)(30,"div",37)(31,"div",38)(32,"div",39)(33,"h4",11)(34,"span",12),t.EFF(35),t.k0s()(),t.j41(36,"button",13),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.exportMeetingToExcel())}),t.nrm(37,"i",14),t.EFF(38),t.k0s()()(),t.j41(39,"div",40)(40,"div",41)(41,"div",42)(42,"div",43)(43,"div",44),t.EFF(44),t.k0s(),t.j41(45,"div",45),t.EFF(46),t.nI1(47,"number"),t.k0s()()(),t.j41(48,"div",42)(49,"div",43)(50,"div",44),t.EFF(51),t.k0s(),t.j41(52,"div",45),t.EFF(53),t.nI1(54,"number"),t.k0s()()()(),t.DNE(55,U,4,2,"div",19)(56,Y,4,1,"div",20),t.k0s()()()()}if(2&r){const e=t.XpG();t.R7$(7),t.JRh(e.getText("KNOWLEDGE_ORDERS")),t.R7$(),t.Y8G("disabled",e.isLoading||!(null!=e.totalStatistics&&null!=e.totalStatistics.knowledge_order_statistics&&e.totalStatistics.knowledge_order_statistics.company_insighter_orders_statistics)),t.R7$(2),t.SpI(" ",e.getText("EXPORT_TO_EXCEL")," "),t.R7$(6),t.JRh(e.getText("TOTAL_ORDERS")),t.R7$(2),t.JRh(t.bMT(19,18,e.totalStatistics.knowledge_order_statistics.orders_total)),t.R7$(5),t.JRh(e.getText("ORDERS_REVENUE")),t.R7$(2),t.SpI("$",t.i5U(26,20,e.totalStatistics.knowledge_order_statistics.orders_amount,"1.2-2"),""),t.R7$(2),t.Y8G("ngIf",e.knowledgeChartData&&!e.isLoading),t.R7$(),t.Y8G("ngIf",e.isLoading),t.R7$(7),t.JRh(e.getText("MEETING_ORDERS")),t.R7$(),t.Y8G("disabled",e.isLoading||!(null!=e.totalStatistics&&null!=e.totalStatistics.meeting_booking_order_statistics&&e.totalStatistics.meeting_booking_order_statistics.company_insighter_orders_statistics)),t.R7$(2),t.SpI(" ",e.getText("EXPORT_TO_EXCEL")," "),t.R7$(6),t.JRh(e.getText("TOTAL_ORDERS")),t.R7$(2),t.JRh(t.bMT(47,23,e.totalStatistics.meeting_booking_order_statistics.orders_total)),t.R7$(5),t.JRh(e.getText("ORDERS_REVENUE")),t.R7$(2),t.SpI("$",t.i5U(54,25,e.totalStatistics.meeting_booking_order_statistics.orders_amount,"1.2-2"),""),t.R7$(2),t.Y8G("ngIf",e.meetingChartData&&!e.isLoading),t.R7$(),t.Y8G("ngIf",e.isLoading)}}let X=(()=>{class r extends S.${salesService;authService;destroy$=new R.B;resizeTimeout=null;resizeObserver;chartContainers=[];revenueChart;knowledgeChart;meetingChart;set revenueChartContainerRef(e){e&&this.chartContainers[0]!==e&&(this.chartContainers[0]=e,this.initResizeObserver(),this.scheduleChartRefresh(0))}set knowledgeChartContainerRef(e){e&&this.chartContainers[1]!==e&&(this.chartContainers[1]=e,this.initResizeObserver(),this.scheduleChartRefresh(0))}set meetingChartContainerRef(e){e&&this.chartContainers[2]!==e&&(this.chartContainers[2]=e,this.initResizeObserver(),this.scheduleChartRefresh(0))}selectedPeriod="weekly";isLoading=!1;totalStatistics=null;periodStatistics=null;isCompany=!1;isInsighter=!1;revenueChartData=null;revenueChartOptions=null;knowledgeChartData=null;knowledgeChartOptions=null;meetingChartData=null;meetingChartOptions=null;periodOptions=[{label:"Weekly",labelAr:"\u0623\u0633\u0628\u0648\u0639\u064a",value:"weekly"},{label:"Monthly",labelAr:"\u0634\u0647\u0631\u064a",value:"monthly"},{label:"Yearly",labelAr:"\u0633\u0646\u0648\u064a",value:"yearly"}];constructor(e,o,n){super(e),this.salesService=o,this.authService=n}ngAfterViewInit(){this.initResizeObserver(),this.scheduleChartRefresh()}ngOnInit(){this.checkUserRole(),this.loadData()}ngOnDestroy(){this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.teardownResizeObserver(),this.destroy$.next(),this.destroy$.complete(),super.ngOnDestroy()}getText(e){const n={TOTAL_ORDERS:{en:"Total Orders",ar:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0637\u0644\u0628\u0627\u062a"},ORDERS_REVENUE:{en:"Orders Revenue",ar:"\u0625\u064a\u0631\u0627\u062f\u0627\u062a \u0627\u0644\u0637\u0644\u0628\u0627\u062a"},NET_PROFIT:{en:"Net Profit",ar:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0628\u062d"},COMPANY_NET_PROFIT:{en:"Company Net Profit",ar:"\u0635\u0627\u0641\u064a \u0631\u0628\u062d \u0627\u0644\u0634\u0631\u0643\u0629"},REVENUE_CHART:{en:"Revenue Chart",ar:"\u0645\u062e\u0637\u0637 \u0627\u0644\u0625\u064a\u0631\u0627\u062f\u0627\u062a"},KNOWLEDGE_ORDERS:{en:"Knowledge Orders",ar:"\u0637\u0644\u0628\u0627\u062a \u0627\u0644\u0645\u0639\u0631\u0641\u0629"},MEETING_ORDERS:{en:"Meeting Orders",ar:"\u0637\u0644\u0628\u0627\u062a \u0627\u0644\u0627\u062c\u062a\u0645\u0627\u0639\u0627\u062a"},LOADING:{en:"Loading...",ar:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."},WEEKLY:{en:"Weekly",ar:"\u0623\u0633\u0628\u0648\u0639\u064a"},MONTHLY:{en:"Monthly",ar:"\u0634\u0647\u0631\u064a"},YEARLY:{en:"Yearly",ar:"\u0633\u0646\u0648\u064a"},KNOWLEDGE:{en:"Knowledge",ar:"\u0627\u0644\u0645\u0639\u0631\u0641\u0629"},MEETINGS:{en:"Meetings",ar:"\u0627\u0644\u0627\u062c\u062a\u0645\u0627\u0639\u0627\u062a"},TOTAL_AMOUNT:{en:"Total Amount",ar:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0628\u0644\u063a"},EXPORT_TO_EXCEL:{en:"Export to Excel",ar:"\u062a\u0635\u062f\u064a\u0631 \u0625\u0644\u0649 Excel"},INSIGHTER_NAME:{en:"Insighter Name",ar:"\u0627\u0633\u0645 \u0627\u0644\u062e\u0628\u064a\u0631"},COMPANY_PROFIT:{en:"Company Profit",ar:"\u0631\u0628\u062d \u0627\u0644\u0634\u0631\u0643\u0629"}}[e];return n?"ar"===this.lang?n.ar:n.en:e}checkUserRole(){this.authService.getProfile().pipe((0,b.Q)(this.unsubscribe$),(0,T.s)(1)).subscribe(o=>{o&&o.roles&&(this.isCompany=o.roles.includes("company"),this.isInsighter=o.roles.includes("insighter"))})}onPeriodChange(e){console.log("\u{1f504} Period change requested:",e),console.log("\u{1f4c5} Current selectedPeriod before change:",this.selectedPeriod),this.selectedPeriod=e,console.log("\u{1f4c5} New selectedPeriod after change:",this.selectedPeriod),this.loadPeriodStatistics()}onWindowResize(){this.scheduleChartRefresh()}scheduleChartRefresh(e=150){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.refreshAllCharts()},e)}refreshAllCharts(){[this.revenueChart,this.knowledgeChart,this.meetingChart].forEach(o=>{o&&(o.chart&&(o.chart.canvas.style.width="100%",o.chart.resize(),o.chart.update("none")),"function"==typeof o.reinit&&o.reinit())})}initResizeObserver(){if(typeof window>"u"||!window.ResizeObserver)return;this.teardownResizeObserver();const e=window.ResizeObserver;this.resizeObserver=new e(()=>{this.scheduleChartRefresh(100)}),this.chartContainers.forEach(o=>{o?.nativeElement&&this.resizeObserver.observe(o.nativeElement)})}teardownResizeObserver(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)}loadData(){this.isLoading=!0,console.log("\u{1f4ca} Sales Component - Loading data with isCompany:",this.isCompany);const e=this.isCompany?this.salesService.getCompanyTotalStatistics():this.salesService.getInsighterTotalStatistics(),o=this.isCompany?this.salesService.getCompanyPeriodStatistics(this.selectedPeriod):this.salesService.getInsighterPeriodStatistics(this.selectedPeriod);console.log("\u{1f517} Sales Component - Using total stats method:",this.isCompany?"getCompanyTotalStatistics":"getInsighterTotalStatistics"),console.log("\u{1f517} Sales Component - Using period stats method:",this.isCompany?"getCompanyPeriodStatistics":"getInsighterPeriodStatistics"),console.log("\u{1f4c5} Sales Component - Selected period:",this.selectedPeriod),(0,E.p)([e,o]).pipe((0,b.Q)(this.unsubscribe$)).subscribe({next:([n,i])=>{console.log("\u2705 Sales Component - Total stats response:",n),console.log("\u2705 Sales Component - Period stats response:",i),this.totalStatistics=n.data,this.periodStatistics=i.data,this.setupCharts(),this.isLoading=!1},error:n=>{console.error("\u274c Sales Component - Error loading data:",n),this.handleServerErrors(n),this.isLoading=!1}})}loadPeriodStatistics(){this.isLoading=!0,console.log("\u{1f4c8} Sales Component - Loading period stats with isCompany:",this.isCompany),console.log("\u{1f4c5} Sales Component - Period filter changed to:",this.selectedPeriod);const e=this.isCompany?this.salesService.getCompanyPeriodStatistics(this.selectedPeriod):this.salesService.getInsighterPeriodStatistics(this.selectedPeriod);console.log("\u{1f517} Sales Component - Using period stats method:",this.isCompany?"getCompanyPeriodStatistics":"getInsighterPeriodStatistics"),e.pipe((0,b.Q)(this.unsubscribe$)).subscribe({next:o=>{console.log("\u2705 Sales Component - Period stats response:",o),this.periodStatistics=o.data,this.setupRevenueChart(),this.isLoading=!1},error:o=>{console.error("\u274c Sales Component - Error loading period stats:",o),this.handleServerErrors(o),this.isLoading=!1}})}setupCharts(){this.setupRevenueChart(),this.isCompany&&(this.setupKnowledgeChart(),this.setupMeetingChart())}setupRevenueChart(){if(!this.periodStatistics)return;const e=Object.keys(this.periodStatistics.order_statistics),o=e.map(s=>Math.max(0,this.periodStatistics.knowledge_order_statistics[s]?.orders_amount||0)),n=e.map(s=>Math.max(0,this.periodStatistics.meeting_booking_order_statistics[s]?.orders_amount||0)),i=(s,a,h)=>{const p=s.createLinearGradient(0,0,0,400);return p.addColorStop(0,a),p.addColorStop(1,h),p};this.revenueChartData={labels:e,datasets:[{label:this.getText("KNOWLEDGE"),data:o,borderColor:"#3799FF",backgroundColor:s=>{const a=s.chart,{ctx:h}=a;return i(h,"rgba(55, 153, 255, 0.3)","rgba(55, 153, 255, 0)")},borderWidth:2,fill:!0,tension:.4,pointBackgroundColor:"#3799FF",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6,pointHoverBackgroundColor:"#3799FF",pointHoverBorderColor:"#ffffff",pointHoverBorderWidth:3},{label:this.getText("MEETINGS"),data:n,borderColor:"#50C878",backgroundColor:s=>{const a=s.chart,{ctx:h}=a;return i(h,"rgba(80, 200, 120, 0.2)","rgba(80, 200, 120, 0)")},borderWidth:2,fill:!0,tension:.4,pointBackgroundColor:"#50C878",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6,pointHoverBackgroundColor:"#50C878",pointHoverBorderColor:"#ffffff",pointHoverBorderWidth:3}]},this.revenueChartOptions={responsive:!0,maintainAspectRatio:!1,onHover:(s,a,h)=>{a.length>0?this.updateHoverAnnotation(h,a[0].index):this.clearHoverAnnotation(h)},plugins:{legend:{display:!1},tooltip:{backgroundColor:"#ffffff",titleColor:"#1f2937",bodyColor:"#1f2937",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,displayColors:!0,usePointStyle:!0,padding:12,titleFont:{size:12,weight:"600"},bodyFont:{size:11},callbacks:{label:s=>`${s.dataset.label}: $${s.parsed.y.toLocaleString()}`}},annotation:{annotations:this.createVerticalAnnotations(e)}},scales:{x:{grid:{color:"#f3f4f6",lineWidth:1,drawBorder:!1},ticks:{color:"#6b7280",font:{size:11}}},y:{grid:{color:"#f3f4f6",lineWidth:1,drawBorder:!1},ticks:{color:"#6b7280",font:{size:11},callback:function(s,a,h){return"$"+s.toLocaleString()}}}},interaction:{intersect:!1,mode:"index"}},this.scheduleChartRefresh()}setupKnowledgeChart(){if(!this.totalStatistics?.knowledge_order_statistics.company_insighter_orders_statistics)return;const e=this.totalStatistics.knowledge_order_statistics.company_insighter_orders_statistics,o=e.map(i=>i.insighter_name),n=e.map(i=>Math.max(0,i.total_amount));this.knowledgeChartData={labels:o,datasets:[{label:this.getText("TOTAL_AMOUNT"),data:n,backgroundColor:["#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef"],borderColor:["#2563eb","#4f46e5","#7c3aed","#9333ea","#c026d3"],borderWidth:1,borderRadius:4,maxBarThickness:40}]},this.knowledgeChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#ffffff",titleColor:"#1f2937",bodyColor:"#1f2937",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,callbacks:{label:i=>`${i.dataset.label}: $${i.parsed.y.toLocaleString()}`}}},scales:{x:{grid:{display:!1},border:{display:!1},ticks:{color:"#6b7280",font:{size:11}}},y:{grid:{color:"#f3f4f6",borderDash:[3,3]},border:{display:!1},beginAtZero:!0,ticks:{color:"#6b7280",font:{size:11},callback:function(i){return"$"+i.toLocaleString()}}}}}}setupMeetingChart(){if(!this.totalStatistics?.meeting_booking_order_statistics.company_insighter_orders_statistics)return;const e=this.totalStatistics.meeting_booking_order_statistics.company_insighter_orders_statistics,o=e.map(i=>i.insighter_name),n=e.map(i=>Math.max(0,i.total_amount));this.meetingChartData={labels:o,datasets:[{label:this.getText("TOTAL_AMOUNT"),data:n,backgroundColor:["#10b981","#06b6d4","#3b82f6","#8b5cf6","#f59e0b"],borderColor:["#059669","#0891b2","#2563eb","#7c3aed","#d97706"],borderWidth:1,borderRadius:4,maxBarThickness:40}]},this.meetingChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#ffffff",titleColor:"#1f2937",bodyColor:"#1f2937",borderColor:"#e5e7eb",borderWidth:1,cornerRadius:8,callbacks:{label:i=>`${i.dataset.label}: $${i.parsed.y.toLocaleString()}`}}},scales:{x:{grid:{display:!1},border:{display:!1},ticks:{color:"#6b7280",font:{size:11}}},y:{grid:{color:"#f3f4f6",borderDash:[3,3]},border:{display:!1},beginAtZero:!0,ticks:{color:"#6b7280",font:{size:11},callback:function(i){return"$"+i.toLocaleString()}}}}},this.scheduleChartRefresh()}handleServerErrors(e){if(e.error&&e.error.errors){const o=e.error.errors;for(const n in o)o.hasOwnProperty(n)&&this.showError("ar"===this.lang?"\u062d\u062f\u062b \u062e\u0637\u0623":"An error occurred",o[n].join(", "))}else this.showError("ar"===this.lang?"\u062d\u062f\u062b \u062e\u0637\u0623":"An error occurred","ar"===this.lang?"\u062d\u062f\u062b \u062e\u0637\u0623 \u063a\u064a\u0631 \u0645\u062a\u0648\u0642\u0639":"An unexpected error occurred.")}createVerticalAnnotations(e){if(!e||0===e.length)return{};const o={};return e.forEach((n,i)=>{o[`verticalLine${i}`]={type:"line",scaleID:"x",value:i,borderColor:"rgba(209, 213, 219, 0)",borderWidth:1,borderDash:[3,3],label:{display:!1}}}),o}updateHoverAnnotation(e,o){if(!e||!e.options.plugins.annotation)return;const n=e.options.plugins.annotation.annotations;Object.keys(n).forEach(s=>{s.startsWith("verticalLine")&&(n[s].borderColor="rgba(209, 213, 219, 0)")});const i=n[`verticalLine${o}`];i&&(i.borderColor="#6b7280",i.borderWidth=2),e.update("none")}clearHoverAnnotation(e){if(!e||!e.options.plugins.annotation)return;const o=e.options.plugins.annotation.annotations;Object.keys(o).forEach(n=>{n.startsWith("verticalLine")&&(o[n].borderColor="rgba(209, 213, 219, 0)",o[n].borderWidth=1)}),e.update("none")}exportToExcel(){if(this.periodStatistics)try{const e=c.Wp.book_new(),o=Object.keys(this.periodStatistics.order_statistics),i=[["ar"===this.lang?"\u0627\u0644\u0641\u062a\u0631\u0629":"Period",this.getText("TOTAL_ORDERS"),this.getText("ORDERS_REVENUE"),this.getText(this.isCompany?"COMPANY_NET_PROFIT":"NET_PROFIT")],...o.map(d=>[d,this.periodStatistics.order_statistics[d]?.orders_total||0,`$${this.periodStatistics.order_statistics[d]?.orders_amount||0}`,`$${this.isCompany?this.periodStatistics.order_statistics[d]?.company_orders_amount||0:this.periodStatistics.order_statistics[d]?.insighter_orders_amount||0}`])],s=c.Wp.aoa_to_sheet(i);c.Wp.book_append_sheet(e,s,"ar"===this.lang?"\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a_\u0627\u0644\u0637\u0644\u0628\u0627\u062a":"Order_Statistics");const h=[["ar"===this.lang?"\u0627\u0644\u0641\u062a\u0631\u0629":"Period",this.getText("TOTAL_ORDERS"),this.getText("ORDERS_REVENUE"),this.getText(this.isCompany?"COMPANY_NET_PROFIT":"NET_PROFIT")],...o.map(d=>[d,this.periodStatistics.knowledge_order_statistics[d]?.orders_total||0,`$${this.periodStatistics.knowledge_order_statistics[d]?.orders_amount||0}`,`$${this.isCompany?this.periodStatistics.knowledge_order_statistics[d]?.company_orders_amount||0:this.periodStatistics.knowledge_order_statistics[d]?.insighter_orders_amount||0}`])],p=c.Wp.aoa_to_sheet(h);c.Wp.book_append_sheet(e,p,"ar"===this.lang?"\u0637\u0644\u0628\u0627\u062a_\u0627\u0644\u0645\u0639\u0631\u0641\u0629":"Knowledge_Orders");const m=[["ar"===this.lang?"\u0627\u0644\u0641\u062a\u0631\u0629":"Period",this.getText("TOTAL_ORDERS"),this.getText("ORDERS_REVENUE"),this.getText(this.isCompany?"COMPANY_NET_PROFIT":"NET_PROFIT")],...o.map(d=>[d,this.periodStatistics.meeting_booking_order_statistics[d]?.orders_total||0,`$${this.periodStatistics.meeting_booking_order_statistics[d]?.orders_amount||0}`,`$${this.isCompany?this.periodStatistics.meeting_booking_order_statistics[d]?.company_orders_amount||0:this.periodStatistics.meeting_booking_order_statistics[d]?.insighter_orders_amount||0}`])],Q=c.Wp.aoa_to_sheet(m);c.Wp.book_append_sheet(e,Q,"ar"===this.lang?"\u0637\u0644\u0628\u0627\u062a_\u0627\u0644\u0627\u062c\u062a\u0645\u0627\u0639\u0627\u062a":"Meeting_Orders");const Z=(new Date).toISOString().split("T")[0],x=this.selectedPeriod.charAt(0).toUpperCase()+this.selectedPeriod.slice(1),q=`${"ar"===this.lang?"\u062a\u0642\u0631\u064a\u0631_\u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a":"sales_report"}_${x}_${Z}.xlsx`,tt=c.M9(e,{bookType:"xlsx",type:"array"}),et=new Blob([tt],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,u.saveAs)(et,q),this.showSuccess("ar"===this.lang?"\u0646\u062c\u062d \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Successful","ar"===this.lang?`\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u062a\u0642\u0631\u064a\u0631 ${this.getText(this.selectedPeriod.toUpperCase())} \u0628\u0646\u062c\u0627\u062d`:`${x} report exported successfully`)}catch(e){console.error("Error exporting to Excel:",e),this.showError("ar"===this.lang?"\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Error","ar"===this.lang?"\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u0635\u062f\u064a\u0631 \u0627\u0644\u062a\u0642\u0631\u064a\u0631":"An error occurred while exporting the report")}else this.showWarn("ar"===this.lang?"\u062a\u062d\u0630\u064a\u0631":"Warning","ar"===this.lang?"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u062a\u0635\u062f\u064a\u0631":"No data available to export")}exportKnowledgeToExcel(){if(this.totalStatistics?.knowledge_order_statistics?.company_insighter_orders_statistics)try{const e=c.Wp.book_new(),n=[[this.getText("INSIGHTER_NAME"),this.getText("TOTAL_ORDERS"),this.getText("TOTAL_AMOUNT"),this.getText("COMPANY_PROFIT")],...this.totalStatistics.knowledge_order_statistics.company_insighter_orders_statistics.map(m=>[m.insighter_name,m.total_orders,`$${m.total_amount}`,`$${m.total_insighter_amount}`])],i=c.Wp.aoa_to_sheet(n);c.Wp.book_append_sheet(e,i,"ar"===this.lang?"\u0637\u0644\u0628\u0627\u062a_\u0627\u0644\u0645\u0639\u0631\u0641\u0629":"Knowledge_Orders");const a=(new Date).toISOString().split("T")[0],h=`${"ar"===this.lang?"\u062a\u0642\u0631\u064a\u0631_\u0637\u0644\u0628\u0627\u062a_\u0627\u0644\u0645\u0639\u0631\u0641\u0629":"knowledge_orders_report"}_${a}.xlsx`,p=c.M9(e,{bookType:"xlsx",type:"array"}),f=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,u.saveAs)(f,h),this.showSuccess("ar"===this.lang?"\u0646\u062c\u062d \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Successful","ar"===this.lang?"\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u062a\u0642\u0631\u064a\u0631 \u0637\u0644\u0628\u0627\u062a \u0627\u0644\u0645\u0639\u0631\u0641\u0629 \u0628\u0646\u062c\u0627\u062d":"Knowledge orders report exported successfully")}catch(e){console.error("Error exporting knowledge orders to Excel:",e),this.showError("ar"===this.lang?"\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Error","ar"===this.lang?"\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u0635\u062f\u064a\u0631 \u0627\u0644\u062a\u0642\u0631\u064a\u0631":"An error occurred while exporting the report")}else this.showWarn("ar"===this.lang?"\u062a\u062d\u0630\u064a\u0631":"Warning","ar"===this.lang?"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u062a\u0635\u062f\u064a\u0631":"No knowledge orders data available to export")}exportMeetingToExcel(){if(this.totalStatistics?.meeting_booking_order_statistics?.company_insighter_orders_statistics)try{const e=c.Wp.book_new(),n=[[this.getText("INSIGHTER_NAME"),this.getText("TOTAL_ORDERS"),this.getText("TOTAL_AMOUNT"),this.getText("COMPANY_PROFIT")],...this.totalStatistics.meeting_booking_order_statistics.company_insighter_orders_statistics.map(m=>[m.insighter_name,m.total_orders,`$${m.total_amount}`,`$${m.total_insighter_amount}`])],i=c.Wp.aoa_to_sheet(n);c.Wp.book_append_sheet(e,i,"ar"===this.lang?"\u0637\u0644\u0628\u0627\u062a_\u0627\u0644\u0627\u062c\u062a\u0645\u0627\u0639\u0627\u062a":"Meeting_Orders");const a=(new Date).toISOString().split("T")[0],h=`${"ar"===this.lang?"\u062a\u0642\u0631\u064a\u0631_\u0637\u0644\u0628\u0627\u062a_\u0627\u0644\u0627\u062c\u062a\u0645\u0627\u0639\u0627\u062a":"meeting_orders_report"}_${a}.xlsx`,p=c.M9(e,{bookType:"xlsx",type:"array"}),f=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,u.saveAs)(f,h),this.showSuccess("ar"===this.lang?"\u0646\u062c\u062d \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Successful","ar"===this.lang?"\u062a\u0645 \u062a\u0635\u062f\u064a\u0631 \u062a\u0642\u0631\u064a\u0631 \u0637\u0644\u0628\u0627\u062a \u0627\u0644\u0627\u062c\u062a\u0645\u0627\u0639\u0627\u062a \u0628\u0646\u062c\u0627\u062d":"Meeting orders report exported successfully")}catch(e){console.error("Error exporting meeting orders to Excel:",e),this.showError("ar"===this.lang?"\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u0635\u062f\u064a\u0631":"Export Error","ar"===this.lang?"\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u0635\u062f\u064a\u0631 \u0627\u0644\u062a\u0642\u0631\u064a\u0631":"An error occurred while exporting the report")}else this.showWarn("ar"===this.lang?"\u062a\u062d\u0630\u064a\u0631":"Warning","ar"===this.lang?"\u0644\u0627 \u062a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0644\u062a\u0635\u062f\u064a\u0631":"No meeting orders data available to export")}static \u0275fac=function(o){return new(o||r)(t.rXU(t.zZn),t.rXU(k.w),t.rXU(w.p))};static \u0275cmp=t.VBU({type:r,selectors:[["app-sales"]],viewQuery:function(o,n){if(1&o&&(t.GBs(P,5),t.GBs(y,5),t.GBs(M,5),t.GBs($,5),t.GBs(I,5),t.GBs(F,5)),2&o){let i;t.mGM(i=t.lsd())&&(n.revenueChart=i.first),t.mGM(i=t.lsd())&&(n.knowledgeChart=i.first),t.mGM(i=t.lsd())&&(n.meetingChart=i.first),t.mGM(i=t.lsd())&&(n.revenueChartContainerRef=i.first),t.mGM(i=t.lsd())&&(n.knowledgeChartContainerRef=i.first),t.mGM(i=t.lsd())&&(n.meetingChartContainerRef=i.first)}},hostBindings:function(o,n){1&o&&t.bIt("resize",function(){return n.onWindowResize()},!1,t.tSv)},features:[t.Vt3],decls:18,vars:8,consts:[["revenueChartContainer",""],["revenueChart",""],["knowledgeChartContainer",""],["knowledgeChart",""],["meetingChartContainer",""],["meetingChart",""],[1,"d-flex","flex-column","pb-lg-10","pe-10","overflow-hidden"],["class","row mb-5",4,"ngIf"],[1,"card","mb-5","light-sales-gradient-bg"],[1,"card-header","border-0","pt-5"],[1,"d-flex","justify-content-between","align-items-center","w-100","mb-3"],[1,"card-title","align-items-start","flex-column"],[1,"card-label","fw-bold","fs-3","mb-1"],["type","button",1,"btn","btn-light-info","btn-xs",2,"border","1px solid #2CCC63",3,"click","disabled"],[1,"ki-outline","ki-exit-down","fs-4","me-2"],[1,"d-flex","justify-content-end","w-100","pt-5"],[1,"nested-tab-nav"],["type","button","class","nested-tab-button",3,"ngClass","disabled","click",4,"ngFor","ngForOf"],[1,"card-body"],["class","chart-container",4,"ngIf"],["class","d-flex justify-content-center align-items-center","style","height: 300px;",4,"ngIf"],["class","row",4,"ngIf"],[1,"row","mb-5"],[1,"col-xl-4","col-md-12","mb-4"],[1,"card","border-0","shadow-sm","h-100"],[1,"card-body","text-start"],[1,"text-muted","small","mb-3"],[1,"h1","fw-bold","text-dark","mb-0"],["class","col-xl-4 col-md-12 mb-4",4,"ngIf"],["type","button",1,"nested-tab-button",3,"click","ngClass","disabled"],[1,"chart-container"],["type","line",1,"sales-chart",3,"data","options"],[1,"d-flex","justify-content-center","align-items-center",2,"height","300px"],["role","status",1,"spinner-border","text-info"],[1,"visually-hidden"],[1,"row"],[1,"col-xl-6","mb-5"],[1,"card"],[1,"card-header","border-0","pt-5","px-5"],[1,"d-flex","justify-content-between","align-items-center","w-100"],[1,"card-body","pt-0","px-5"],[1,"row","g-3","mb-4"],[1,"col-6"],[1,"simple-stat-card","text-start"],[1,"text-muted","small","mb-2"],[1,"h4","fw-bold","text-dark","mb-0"],["type","bar",1,"sales-chart",3,"data","options"]],template:function(o,n){1&o&&(t.j41(0,"div",6),t.DNE(1,j,19,11,"div",7),t.j41(2,"div",8)(3,"div",9)(4,"div",10)(5,"h3",11)(6,"span",12),t.EFF(7),t.k0s()(),t.j41(8,"button",13),t.bIt("click",function(){return n.exportToExcel()}),t.nrm(9,"i",14),t.EFF(10),t.k0s()(),t.j41(11,"div",15)(12,"div",16),t.DNE(13,G,2,5,"button",17),t.k0s()()(),t.j41(14,"div",18),t.DNE(15,L,4,2,"div",19)(16,W,4,1,"div",20),t.k0s()(),t.DNE(17,H,57,28,"div",21),t.k0s()),2&o&&(t.R7$(),t.Y8G("ngIf",n.totalStatistics),t.R7$(6),t.JRh(n.getText("REVENUE_CHART")),t.R7$(),t.Y8G("disabled",n.isLoading||!n.periodStatistics),t.R7$(2),t.SpI(" ",n.getText("EXPORT_TO_EXCEL")," "),t.R7$(3),t.Y8G("ngForOf",n.periodOptions),t.R7$(2),t.Y8G("ngIf",n.revenueChartData&&!n.isLoading),t.R7$(),t.Y8G("ngIf",n.isLoading),t.R7$(),t.Y8G("ngIf",n.isCompany&&n.totalStatistics))},dependencies:[_.YU,_.Sq,_.bT,v.X,_.QX],styles:[".card[_ngcontent-%COMP%]{border:1px solid #e9ecef;border-radius:.75rem;box-shadow:0 .125rem .25rem #00000013;overflow:hidden}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1.5rem;overflow-x:auto;text-align:start!important}.row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8faff,#f0f4ff);border:1px solid #e8eafd}.row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h1[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0563eb,#06dac4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-weight:700;font-size:2.5rem!important}.row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .text-muted[_ngcontent-%COMP%]{color:#6c7293!important;font-weight:500;text-align:start!important}.row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h1[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h2[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h3[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h4[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h5[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .h6[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .row.mb-5[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{text-align:start!important}.simple-stat-card[_ngcontent-%COMP%]{padding:1.5rem;border:1px solid #e9ecef;border-radius:.5rem;background:#fff;text-align:start!important}.simple-stat-card[_ngcontent-%COMP%]   .h4[_ngcontent-%COMP%]{color:#1f2937;font-weight:600;font-size:1.75rem!important;text-align:start!important}.simple-stat-card[_ngcontent-%COMP%]   .text-muted.small[_ngcontent-%COMP%]{color:#6b7280!important;font-weight:500;font-size:.75rem!important;text-align:start!important}.bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important}.text-success[_ngcontent-%COMP%]{color:#28a745!important}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.card.light-sales-gradient-bg[_ngcontent-%COMP%]{background-image:linear-gradient(to bottom right,#fff,#eceefd)!important;color:#4f28ed!important;border:1px solid #e8eafd!important}.card.light-sales-gradient-bg[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%], .card.light-sales-gradient-bg[_ngcontent-%COMP%]   .card-label[_ngcontent-%COMP%]{text-align:start!important}.light-sales-gradient-bg[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:2rem!important;overflow-x:hidden}.light-sales-gradient-bg[_ngcontent-%COMP%]   .sales-chart[_ngcontent-%COMP%]{margin-top:1rem;border-radius:.5rem;overflow:hidden;position:relative;width:100%;height:200px}.light-sales-gradient-bg[_ngcontent-%COMP%]   .sales-chart[_ngcontent-%COMP%]     .p-chart{width:100%!important;height:100%!important;display:block}.light-sales-gradient-bg[_ngcontent-%COMP%]   .sales-chart[_ngcontent-%COMP%]     .p-chart canvas{width:100%!important;height:100%!important;max-width:100%!important;cursor:pointer!important}.chart-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:100%;overflow:hidden;height:200px}.chart-container[_ngcontent-%COMP%]     .sales-chart .p-chart{width:100%!important;height:100%!important}.chart-container[_ngcontent-%COMP%]     .sales-chart .p-chart canvas{width:100%!important;height:100%!important;cursor:crosshair!important}@media (max-width: 768px){.chart-container[_ngcontent-%COMP%]{height:180px!important}}  .chartjs-tooltip{position:absolute!important;background:#fffffff2!important;border:1px solid #e5e7eb!important;border-radius:8px!important;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f!important;padding:0!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif!important;pointer-events:none!important;transition:all .2s ease!important;z-index:1000!important;min-width:200px!important;-webkit-backdrop-filter:blur(8px)!important;backdrop-filter:blur(8px)!important}  .chartjs-tooltip-header{background:#f9fafb!important;color:#1f2937!important;font-size:12px!important;font-weight:600!important;padding:8px 12px!important;border-bottom:1px solid #e5e7eb!important;border-radius:8px 8px 0 0!important;text-align:center!important}  .chartjs-tooltip-body{padding:8px 12px!important}  .chartjs-tooltip-body .chartjs-tooltip-body-item{display:flex!important;align-items:center!important;margin-bottom:6px!important;font-size:11px!important}  .chartjs-tooltip-body .chartjs-tooltip-body-item:last-child{margin-bottom:0!important}  .chartjs-tooltip-body .chartjs-tooltip-body-item .chartjs-tooltip-color-box{width:8px!important;height:8px!important;border-radius:50%!important;margin-right:8px!important;border:2px solid white!important;box-shadow:0 0 0 1px #0000001a!important}.nested-tab-nav[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem;background-color:#f1f5f9;border-radius:9999px;border:1px solid #e7e7e7}.nested-tab-button[_ngcontent-%COMP%]{border:0;border-radius:9999px;padding:.45rem 1.1rem;font-size:.78rem;font-weight:500;min-width:70px;background-color:transparent;color:#7e8299;transition:all .2s ease;display:inline-flex;align-items:center;justify-content:center;line-height:1.2}.nested-tab-button[_ngcontent-%COMP%]:hover{color:#181c32;background-color:#0f172a0f}.nested-tab-button[_ngcontent-%COMP%]:focus-visible{outline:2px solid rgba(9,120,185,.35);outline-offset:2px}.nested-tab-button.is-active[_ngcontent-%COMP%], .nested-tab-button.active[_ngcontent-%COMP%]{background-color:#fff;color:#0978b9;font-weight:600}@media (max-width: 768px){.nested-tab-nav[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center;width:100%}.nested-tab-button[_ngcontent-%COMP%]{flex:1 1 45%;min-width:140px;text-align:center}.card-header[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:stretch!important}.chart-container[_ngcontent-%COMP%]{height:180px!important}}@media (max-width: 576px){.row.g-3[_ngcontent-%COMP%]{margin:0 -.5rem}.row.g-3[_ngcontent-%COMP%]   .col-4[_ngcontent-%COMP%]{padding:0 .5rem}.h3[_ngcontent-%COMP%]{font-size:1.5rem}.h4[_ngcontent-%COMP%]{font-size:1.25rem}.h5[_ngcontent-%COMP%]{font-size:1.1rem}}"]})}return r})();var V=l(4133);const J=[{path:"",component:X}];let K=(()=>{class r{static \u0275fac=function(o){return new(o||r)};static \u0275mod=t.$C({type:r});static \u0275inj=t.G2t({imports:[_.MD,O.iI.forChild(J),V.E,v.F]})}return r})()}}]);